function reqUpdates(){showBox(),started||ws.send(JSON.stringify({method:"connectToUpdates"}))}ws.onmessage=(t=>{const e=JSON.parse(t.data);console.log(e),"init"==e.method?initUpdateBox(e):"startClock"==e.method?startClock(e):"stopClock"==e.method?stopClock():"updateScore"==e.method?updateScore(e):"statUpdate"==e.method?(updatePlayerStats(e),updateStats(e)):"updateDown"==e.method?updateDown(e):"updatePoss"==e.method?updatePoss(e):"newEvent"==e.method?renderUpdate(e):"declareFinal"==e.method?e.q<5?document.getElementById("updateTime").textContent="FINAL":document.getElementById("updateTime").textContent=`FINAL-${getPeriod(e.q)}`:"eor"==e.method?document.getElementById("updateTime").textContent="END OF REG":"newGame"==e.method&&"flex"==document.getElementById("updateCont").style.display&&(document.cookie="update=true",setTimeout(()=>(location.reload(),!1),1e3))});var awayAbbr,homeAbbr,clock=900,clockInt=!1,period=1,started=!1,goalToGo=!1;function showBox(){document.getElementById("updateCont").style.display="flex",document.body.style.overflow="hidden"}function hideBox(){document.getElementById("updateCont").style.display="none",document.body.style.overflow="auto"}function initUpdateBox(t){started=!0,awayAbbr=t.away,homeAbbr=t.home,period=t.q;var e=getTeamFromAbbr(t.away),o=getTeamFromAbbr(t.home),s=document.getElementById("updateTop");s.children[0].src=`logos/${cleanObj(e)}.png`,s.children[4].src=`logos/${cleanObj(o)}.png`;var a=document.getElementById("updateTable");a.innerHTML="";let n=a.insertRow();n.insertCell();for(let e=0;e<t.awaySbq.length;e++){let t=n.insertCell();t.textContent=e<4?e+1:getPeriod(e+1)}n.insertCell().textContent="T";let l=[t.awaySbq,t.homeSbq],d=[t.awayScore,t.homeScore];var r=[e.mascot,o.mascot];for(let e=0,o=l[0];e<2;o=l[++e]){let s=a.insertRow();s.insertCell().textContent=r[e];for(let e=0;e<o.length;e++){let a=s.insertCell();e<t.q?a.textContent=o[e]:a.textContent="-"}s.insertCell().textContent=d[e]}for(let e of t.updates)e.sort=e.time+900*e.q;t.updates.sort(function(t,e){return e.sort-t.sort});for(let e of t.updates)renderUpdate(e);updatePoss({poss:t.poss}),startClock(t),updatePlayerStats(t),updateStats(t),updateDown(t),updateScore(t)}function renderUpdate(t){var e=document.createElement("DIV");e.classList.add("eventRow"),document.getElementsByClassName("updatePage")[0].prepend(e);var o=buildElem("DIV","eventLeft",void 0,e),s=buildElem("IMG","eventLogo",void 0,o);"away"==t.team?s.src=`logos/${cleanObj(getTeamFromAbbr(awayAbbr))}.png`:s.src=`logos/${cleanObj(getTeamFromAbbr(homeAbbr))}.png`;var a=buildElem("DIV","eventRight",void 0,e);t.q<5?buildElem("SPAN","eventTime",decodeEntities(`${getPeriod(t.q)} &middot; ${toMins(t.t).m}:${toMins(t.t).s}`),a):buildElem("SPAN","eventTime",getPeriod(t.q),a),buildElem("BR",void 0,void 0,a),buildElem("SPAN","eventText",t.text,a)}function updateStats(t){var e=t.awayStats,o=t.homeStats;e.offRating=calcOffRating(e.off.plays,e.off.td,e.off.pts,e.off.yds),e.defRating=calcDefRating(e.def.playsDef,e.def.sacks,e.def.int,e.def.tdGiven,e.def.ydsGiven,e.def.ptsGiven),o.offRating=calcOffRating(o.off.plays,o.off.td,o.off.pts,o.off.yds),o.defRating=calcDefRating(o.def.playsDef,o.def.sacks,o.def.int,o.def.tdGiven,o.def.ydsGiven,e.def.ptsGiven),0!=e.off.plays?e.off.ypp=(e.off.yds/e.off.plays).toFixed(1):e.off.ypp="0.0",0!=o.off.plays?o.off.ypp=(o.off.yds/o.off.plays).toFixed(1):o.off.ypp="0.0";var s=["offRating","defRating","yds","passYds","rushYds","ypp","first","sacks","int"],a=document.getElementsByClassName("updateStatHeader");for(let t=0,r=a[0];t<a.length;r=a[++t]){if(t<2){r.children[0].textContent=e[s[t]],r.children[2].textContent=o[s[t]];var n=Number(e[s[t]]),l=Number(o[s[t]])}else if(t<7){r.children[0].textContent=e.off[s[t]],r.children[2].textContent=o.off[s[t]];n=Number(e.off[s[t]]),l=Number(o.off[s[t]])}else{r.children[0].textContent=e.def[s[t]],r.children[2].textContent=o.def[s[t]];n=Number(e.def[s[t]]),l=Number(o.def[s[t]])}if(n+l!=0){var d=n/(n+l);r.nextElementSibling.children[0].style.width=`calc(${100*d}% - 3px)`}else r.nextElementSibling.children[0].style.width="calc(50% - 3px)"}for(let e of document.getElementsByClassName("updateStatBox"))e.children[0].className="",e.children[0].classList.add("updateStatBar",cleanObj(getTeamFromAbbr(t.away))),e.children[1].className="",e.children[1].classList.add("updateStatBar",cleanObj(getTeamFromAbbr(t.home)))}function updatePoss(t){var e=document.getElementsByClassName("updateBallCont");goalToGo=!1,"away"==t.poss?(e[0].children[0].style.display="block",e[1].children[0].style.display="none"):(e[1].children[0].style.display="block",e[0].children[0].style.display="none")}function updateScore(t){var e=document.getElementById("updateTop");e.children[1].textContent=t.awayScore,e.children[3].textContent=t.homeScore;var o=document.getElementById("updateTable"),s=o.rows[1];s.cells[s.cells.length-1].textContent=t.awayScore;for(let e=1;e<s.cells.length;e++)e<=t.q&&(s.cells[e].textContent=t.awaySbq[e-1]);var a=o.rows[2];for(let e=1;e<a.cells.length;e++)e<=t.q&&(a.cells[e].textContent=t.homeSbq[e-1]);a.cells[a.cells.length-1].textContent=t.homeScore}function startClock(t){var e=document.getElementById("updateTime");if(t.q!=period){var o=document.getElementById("updateTable");if(t.q>4){o.rows[0].insertCell(t.q).textContent=getPeriod(t.q),o.rows[1].insertCell(t.q).textContent=0,o.rows[2].insertCell(t.q).textContent=0}o.rows[1].cells[t.q].textContent=0,o.rows[2].cells[t.q].textContent=0}t.q>4?e.textContent=getPeriod(t.q):t.t<=0||0==clockInt&&(clock=t.t,period=t.q,e.textContent=decodeEntities(`${getPeriod(t.q)} &middot; ${toMins(t.t).m}:${toMins(t.t).s}`),clockInt=setInterval(()=>{clock--,e.textContent=decodeEntities(`${getPeriod(t.q)} &middot; ${toMins(clock).m}:${toMins(clock).s}`),clock<=0&&(stopClock(),e.textContent=decodeEntities(`END ${getPeriod(t.q)}`))},1e3))}function stopClock(){clearInterval(clockInt),clockInt=!1}function updatePlayerStats(t){var e=[];e[0]=[t.awayPlayers.qb,t.homePlayers.qb];for(let t of e[0])t.txt0=`${t.stats.comp}/${t.stats.att}`,t.txt1=t.stats.yds,t.txt2=`${t.stats.td}/${t.stats.int}`,t.txt3=calcQBRating(t.stats.comp,t.stats.att,t.stats.yds,t.stats.td,t.stats.int);e[1]=[t.awayPlayers.rb,t.homePlayers.rb];for(let t of e[1])t.txt0=t.stats.yds,t.txt1=t.stats.att,0!=t.stats.att?t.txt2=(t.stats.yds/t.stats.att).toFixed(1):t.txt2="0.0",t.txt3=t.stats.td;e[2]=[t.awayPlayers.wr,t.awayPlayers.te,t.homePlayers.wr,t.homePlayers.te];for(let t of e[2])t.txt0=t.stats.yds,t.txt1=t.stats.receps,0!=t.stats.receps?t.txt2=(t.stats.yds/t.stats.receps).toFixed(1):t.txt2="0.0",t.txt3=t.stats.td;e[3]=[t.awayPlayers.de,t.awayPlayers.lb,t.homePlayers.de,t.homePlayers.lb];for(let t of e[3])t.txt0=t.stats.tackles,t.txt1=t.stats.tAtt,t.txt2=t.stats.sack,t.txt3=t.stats.blitz;e[4]=[t.awayPlayers.cb,t.awayPlayers.s,t.homePlayers.cb,t.homePlayers.s];for(let t of e[4])t.txt0=t.stats.tackles,t.txt1=t.stats.tAtt,t.txt2=t.stats.int,t.txt3=t.stats.targets;e[5]=[t.awayPlayers.k,t.homePlayers.k];for(let t of e[5])t.txt0=`${t.stats.under40}/${t.stats.under40Att}`,t.txt1=`${t.stats.over40}/${t.stats.over40Att}`,t.txt2=`${t.stats.pat}/${t.stats.patAtt}`,t.txt3=t.stats.pts;e[6]=[t.awayPlayers.p,t.homePlayers.p];for(let t of e[6])0!=t.stats.punts?(t.txt0=(t.stats.yds/t.stats.punts).toFixed(1),t.txt1=(t.stats.net/t.stats.punts).toFixed(1)):(t.txt0="0.0",t.txt1="0.0"),t.txt2=t.stats.in20,t.txt3=t.stats.blocked;var o=document.getElementsByClassName("updatePositionTable");for(let t=0,s=o[0],a=e[0];t<o.length;s=o[++t],a=e[t]){for(;s.rows.length>1;)s.deleteRow(1);for(let t=0,e=a[0];t<a.length;e=a[++t]){let t=s.insertRow(),o=t.insertCell(),a=buildElem("IMG",void 0,void 0,o),n=teams[e.team];a.src=`logos/${cleanObj(n)}.png`,t.insertCell().textContent=`${e.fName} ${e.lName}`;for(let o=0;o<4;o++){t.insertCell().textContent=e[`txt${o}`]}}}}function updatePage(t){var e=document.getElementsByClassName("updatePage"),o=document.getElementsByClassName("updateTab");for(let t of e)t.style.display="none";e[t].style.display="block";for(let t of o)t.style.textDecoration="none";o[t].style.textDecoration="underline"}function updateDown(t){if(!(t.down>4)){if(1==t.down&&t.los>=90&&(goalToGo=!0),50==t.los)var e=50;else if("away"==t.poss&&t.los<50)e=`${awayAbbr} ${t.los}`;else if("home"==t.poss&&t.los<50)e=`${homeAbbr} ${t.los}`;else if("away"==t.poss&&t.los>50)e=`${homeAbbr} ${100-t.los}`;else if("home"==t.poss&&t.los>50)e=`${awayAbbr} ${100-t.los}`;document.getElementById("updateDown").textContent=goalToGo?`${ordinal(t.down).toUpperCase()} & GOAL AT ${e}`:`${ordinal(t.down).toUpperCase()} & ${t.toGo} AT ${e}`}}